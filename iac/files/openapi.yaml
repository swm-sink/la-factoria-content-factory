openapi: 3.0.0
info:
  title: AI Content Factory API (Placeholder - Needs Full Replacement)
  version: v1
  description: |
    IMPORTANT: This is a placeholder OpenAPI specification.
    It MUST be replaced with the actual OpenAPI spec generated by the FastAPI application (e.g., from /openapi.json).
    The current content is a MINIMAL structure to allow API Gateway deployment and basic API key enforcement.
    It DOES NOT accurately reflect all paths, schemas, or operations of your API.

servers:
  # This will be replaced by API Gateway with the Cloud Run backend address
  - url: https://your-cloud-run-service-url.a.run.app # Placeholder, API Gateway configures this

x-google-backend:
  address: "https://<CLOUD_RUN_SERVICE_URL>" # CRITICAL: This needs to be dynamically set in API Gateway config to point to your Cloud Run service.
  # The Terraform module for API Gateway should handle populating this address based on Cloud Run service output.

components:
  securitySchemes:
    ApiKeyAuth: # Arbitrary name for the security scheme
      type: apiKey
      in: header
      name: X-API-Key # Must match the APIKeyHeader name in app/main.py

paths:
  /api/v1/health: # Protected health check
    get:
      summary: API Health Check (Protected)
      operationId: healthCheckV1
      tags:
        - Health
      security:
        - ApiKeyAuth: [] # Requires API Key
      responses:
        '200':
          description: Successful health check
        '401':
          description: Unauthorized (Missing or invalid API Key)

  /api/v1/auth/register: # Public auth endpoint
    post:
      summary: Register User (Public)
      operationId: registerUser
      tags:
        - Authentication
      security: [] # No global ApiKeyAuth for this path
      responses:
        '201':
          description: User registered successfully
        '422':
          description: Validation Error

  /api/v1/auth/login: # Public auth endpoint
    post:
      summary: Login User (Public)
      operationId: loginUser
      tags:
        - Authentication
      security: [] # No global ApiKeyAuth for this path
      responses:
        '200':
          description: Login successful, returns token
        '401':
          description: Invalid credentials

  /api/v1/jobs: # Protected jobs endpoint
    post:
      summary: Create Content Generation Job (Protected)
      operationId: createJob
      tags:
        - Jobs
      security:
        - ApiKeyAuth: [] # Requires API Key
      requestBody:
        description: Job creation payload (Example - replace with actual schema from ContentRequest)
        required: true
        content:
          application/json:
            schema:
              type: object 
              properties:
                syllabus_text:
                  type: string
                target_format:
                  type: string
      responses:
        '201':
          description: Job created (Example - replace with actual schema from Job model)
        '401':
          description: Unauthorized
        '422':
          description: Validation Error

  # TODO: USER ACTION REQUIRED: Add all other actual paths and operations from your FastAPI /openapi.json here.
  # Ensure request/response schemas are accurately defined.

# Define x-google-backend for Cloud Run integration
# This will be referenced in the API Config
x-google-backend:
  address: "YOUR_CLOUD_RUN_SERVICE_URL" # This will be replaced by Terraform using the Cloud Run service URL
  # path_translation: CONSTANT_ADDRESS
  # jwt_audience: "YOUR_CLOUD_RUN_SERVICE_URL_OR_CUSTOM_AUDIENCE" # If using IAP or custom JWT auth for Cloud Run 